<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="main.css" />
    <title>Document</title>
  </head>
  <body>
    <h1>Task List</h1>
    <form>
      <label for="newTask">New task:</label>
      <input type="text" id="newTask" />
      <button type="submit" id="addTask">Add</button>
    </form>
    <ul id="taskList"></ul>

    <script>
      // const task ={
      //     id: 1,
      //     text: "Task 1",
      //     completed: false,
      // }

      let tasks = [
        {
          id: "1",
          text: "Task 1",
          isCompleted: true,
        },
      ];

      // const tasks = [];

      // Додавання елементу

      const addBtn = document.getElementById("addTask");
      const newTaskText = document.getElementById("newTask");
      const list = document.getElementById("taskList");

      addBtn.addEventListener("click", (e) => {
        e.preventDefault();

        const taskObj = {
          id: !tasks.length
            ? "0"
            : (Number(tasks[tasks.length - 1].id) + 1).toString(),
          text: newTaskText.value,
          isCompleted: false,
        };

        tasks.push(taskObj);
        console.log(tasks);
        renderTasks();
      });

      list.addEventListener("click", (e) => {
        // checkbox
        console.log(e.target);
        if (e.target.type == "checkbox") {
          completeTask(e.target.parentNode.id);
        }

        // button
        if (e.target.nodeName == "BUTTON") {
          deleteTask(e.target.parentNode.id);
        }
      });

      function deleteTask(id) {
        tasks = tasks.filter((value) => value.id !== id);

        renderTasks();
      }

      function completeTask(id) {
        console.log("id", typeof id);
        tasks = tasks.map((value) => {
          console.log("is equal", value.id == id);
          const item =
            value.id === id
              ? { ...value, isCompleted: !value.isCompleted }
              : value;
          console.log("item", item);
          return item;
        });

        console.log("completed tasks:", tasks);
        renderTasks();
      }

      function renderTasks() {
        console.log("render");
        const tmp = tasks.reduce((acc, value) => {
          const item = `<li id=${value.id}>
    <input type="checkbox" id="task-${value.id}" ${
            value.isCompleted ? "checked" : ""
          } />
    <label for="task-${value.id}">${value.text}</label>
    <button>Delete</button>
  </li>`;
          return (acc += item);
        }, "");

        list.innerHTML = tmp;
      }

      renderTasks();
    </script>
  </body>
</html>
